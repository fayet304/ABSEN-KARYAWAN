<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Login Admin & User</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #f4f4f4; }
    .container { display: flex; justify-content: center; gap: 30px; margin-top: 50px; }
    .box { width: 320px; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px #ccc; }
    input, select { width: 100%; padding: 10px; margin: 8px 0; border-radius: 5px; border: 1px solid #ccc; }
    button { padding: 10px; background: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer; }
    header { background: #2c3e50; color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; }
    .menu { display: flex; gap: 10px; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    th { background: #ecf0f1; }
    tr:nth-child(even) { background: #f9f9f9; }
    #main, #absensi-page { display: none; padding: 20px; }
    .hidden { display: none; }
    #izin-form { display:none; margin-top:20px; padding:15px; background:#fff; border-radius:8px; box-shadow:0 0 5px #bbb; }
    .status-tepat { background: #2ecc71; color: white; }
    .status-terlambat { background: #e74c3c; color: white; }
    .status-izin { background: #f1c40f; }
  </style>
</head>
<body>

<!-- LOGIN PILIHAN -->
<div class="container" id="login-page">
  <!-- ADMIN LOGIN -->
  <div class="box">
    <h2>Login Admin</h2>
    <input type="text" id="admin-username" placeholder="User Name">
    <input type="password" id="admin-password" placeholder="Password">
    <button onclick="loginAdmin()">Login Admin</button>
    <p id="admin-error" style="color:red;"></p>
  </div>

  <!-- USER LOGIN -->
  <div class="box">
    <h2>Login User</h2>
    <select id="user-nama"></select>
    <select id="user-divisi">
      <option>Marketing</option>
      <option>Operator Kasir</option>
    </select>
    <select id="user-shift">
      <option value="Pagi">Pagi</option>
      <option value="Siang">Siang</option>
      <option value="Malam">Malam</option>
    </select>
    <button onclick="loginUser()">Absen & Masuk</button>
  </div>
</div>

<!-- DASHBOARD ADMIN -->
<div id="main">
  <header>
    <h2>Dashboard Admin</h2>
    <div class="menu">
      <button onclick="showTab('anggota')">Data Anggota</button>
      <button onclick="showTab('absensi')">Lihat Absensi</button>
      <button onclick="showTab('izin')">Lihat Izin</button>
      <button onclick="logout()">Logout</button>
    </div>
  </header>

  <!-- TAB ANGGOTA -->
  <div id="tab-anggota">
    <table id="data-table">
      <thead>
        <tr>
          <th>No</th>
          <th>Nama Lengkap</th>
          <th>Email</th>
          <th>Divisi</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>1</td>
          <td>Andhika Restu Putra</td>
          <td>kotabersama88@gmail.com</td>
          <td>Marketing</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- TAB ABSENSI -->
  <div id="tab-absensi" class="hidden">
    <h3>Data Absensi User</h3>
    <table id="absensi-table-admin">
      <thead>
        <tr>
          <th>No</th>
          <th>Nama</th>
          <th>Divisi</th>
          <th>Shift</th>
          <th>Jam Masuk</th>
          <th>Tanggal</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- TAB IZIN -->
  <div id="tab-izin" class="hidden">
    <h3>Data Izin Keluar</h3>
    <table id="izin-table-admin">
      <thead>
        <tr>
          <th>No</th>
          <th>Nama</th>
          <th>Divisi</th>
          <th>Alasan</th>
          <th>Tanggal</th>
          <th>Jam</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<!-- HALAMAN ABSENSI USER -->
<div id="absensi-page">
  <h2>Riwayat Absensi</h2>
  <table id="absensi-table">
    <thead>
      <tr>
        <th>No</th>
        <th>Nama</th>
        <th>Divisi</th>
        <th>Shift</th>
        <th>Jam Masuk</th>
        <th>Tanggal</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <br>
  <button onclick="toggleIzinForm()">Ajukan Izin Keluar</button>
  <div id="izin-form">
    <h3>Form Izin Keluar</h3>
    <input type="text" id="izin-alasan" placeholder="Alasan Izin">
    <button onclick="submitIzin()">Kirim Izin</button>
  </div>
  <br>
  <button onclick="logout()">Logout</button>
</div>

<script>
  const correctUsername = "absen";
  const correctPassword = "@jaya88";
  const shiftRules = { "Pagi": "08:00", "Siang": "16:00", "Malam": "22:00" };
  let currentUser = "";

  // Auto redirect if already logged in
  window.onload = function() {
    loadUserDropdown();
    const role = localStorage.getItem("role");
    currentUser = localStorage.getItem("currentUser") || "";
    if (role === "admin") {
      document.getElementById("login-page").style.display = "none";
      document.getElementById("main").style.display = "block";
      showTab('anggota');
      loadAbsensiAdmin();
      loadIzinAdmin();
    } else if (role === "user" && currentUser) {
      document.getElementById("login-page").style.display = "none";
      document.getElementById("absensi-page").style.display = "block";
      loadAbsensiUser(currentUser);
    }
  };

  // LOGIN ADMIN
  function loginAdmin() {
    const username = document.getElementById("admin-username").value;
    const password = document.getElementById("admin-password").value;
    if (username === correctUsername && password === correctPassword) {
      localStorage.setItem("role", "admin");
      document.getElementById("login-page").style.display = "none";
      document.getElementById("main").style.display = "block";
      showTab('anggota');
      loadAbsensiAdmin();
      loadIzinAdmin();
    } else {
      document.getElementById("admin-error").innerText = "User Name atau Password salah!";
    }
  }

  // LOGIN USER
  function loginUser() {
    const nama = document.getElementById("user-nama").value;
    const divisi = document.getElementById("user-divisi").value;
    const shift = document.getElementById("user-shift").value;
    if (!nama) { alert("Harap pilih nama!"); return; }
    const jamMasuk = new Date().toLocaleTimeString("id-ID", {hour: '2-digit', minute:'2-digit'});
    const tanggal = new Date().toLocaleDateString("id-ID");
    const status = jamMasuk > shiftRules[shift] ? "Terlambat" : "Tepat Waktu";

    const data = { nama, divisi, shift, jamMasuk, tanggal, status };
    let absenData = JSON.parse(localStorage.getItem("absensi") || "[]");
    absenData.push(data);
    localStorage.setItem("absensi", JSON.stringify(absenData));

    currentUser = nama;
    localStorage.setItem("role", "user");
    localStorage.setItem("currentUser", nama);

    document.getElementById("login-page").style.display = "none";
    document.getElementById("absensi-page").style.display = "block";
    loadAbsensiUser(nama);
  }

  // LOGOUT
  function logout() {
    localStorage.removeItem("role");
    localStorage.removeItem("currentUser");
    currentUser = "";
    document.getElementById("main").style.display = "none";
    document.getElementById("absensi-page").style.display = "none";
    document.getElementById("login-page").style.display = "flex";
  }

  // TABS ADMIN
  function showTab(tab) {
    document.getElementById("tab-anggota").classList.add("hidden");
    document.getElementById("tab-absensi").classList.add("hidden");
    document.getElementById("tab-izin").classList.add("hidden");
    if (tab === 'anggota') document.getElementById("tab-anggota").classList.remove("hidden");
    if (tab === 'absensi') { document.getElementById("tab-absensi").classList.remove("hidden"); loadAbsensiAdmin(); }
    if (tab === 'izin') { document.getElementById("tab-izin").classList.remove("hidden"); loadIzinAdmin(); }
  }

  // LOAD DROPDOWN USER
  function loadUserDropdown() {
    const select = document.getElementById("user-nama");
    select.innerHTML = "<option value=''>Pilih Nama</option>";
    const table = document.getElementById("data-table").getElementsByTagName('tbody')[0];
    for (let i=0; i<table.rows.length; i++) {
      const nama = table.rows[i].cells[1].innerText;
      const option = document.createElement("option");
      option.value = nama;
      option.text = nama;
      select.appendChild(option);
    }
  }

  // ABSENSI USER
  function loadAbsensiUser(nama) {
    const table = document.getElementById("absensi-table").getElementsByTagName('tbody')[0];
    table.innerHTML = "";
    let absenData = JSON.parse(localStorage.getItem("absensi") || "[]");
    absenData.filter(d => d.nama === nama).forEach((d,i) => {
      const row = table.insertRow();
      row.insertCell(0).innerText = i+1;
      row.insertCell(1).innerText = d.nama;
      row.insertCell(2).innerText = d.divisi;
      row.insertCell(3).innerText = d.shift;
      row.insertCell(4).innerText = d.jamMasuk;
      row.insertCell(5).innerText = d.tanggal;
      const statusCell = row.insertCell(6);
      statusCell.innerText = d.status;
      if (d.status === "Tepat Waktu") statusCell.className = "status-tepat";
      else if (d.status === "Terlambat") statusCell.className = "status-terlambat";
    });
  }

  // ABSENSI ADMIN
  function loadAbsensiAdmin() {
    const table = document.getElementById("absensi-table-admin").getElementsByTagName('tbody')[0];
    table.innerHTML = "";
    let absenData = JSON.parse(localStorage.getItem("absensi") || "[]");
    absenData.forEach((d,i) => {
      const row = table.insertRow();
      row.insertCell(0).innerText = i+1;
      row.insertCell(1).innerText = d.nama;
      row.insertCell(2).innerText = d.divisi;
      row.insertCell(3).innerText = d.shift;
      row.insertCell(4).innerText = d.jamMasuk;
      row.insertCell(5).innerText = d.tanggal;
      const statusCell = row.insertCell(6);
      statusCell.innerText = d.status;
      if (d.status === "Tepat Waktu") statusCell.className = "status-tepat";
      else if (d.status === "Terlambat") statusCell.className = "status-terlambat";
    });
  }

  // FORM IZIN
  function toggleIzinForm() {
    const form = document.getElementById("izin-form");
    form.style.display = (form.style.display === "block") ? "none" : "block";
  }

  function submitIzin() {
    const alasan = document.getElementById("izin-alasan").value;
    if (!alasan) { alert("Harap isi alasan izin"); return; }
    const tanggal = new Date().toLocaleDateString("id-ID");
    const jam = new Date().toLocaleTimeString("id-ID", {hour:'2-digit', minute:'2-digit'});
    const data = { nama: currentUser, divisi: document.getElementById("user-divisi").value, alasan, tanggal, jam };
    let izinData = JSON.parse(localStorage.getItem("izin") || "[]");
    izinData.push(data);
    localStorage.setItem("izin", JSON.stringify(izinData));
    alert("Izin berhasil diajukan!");
    document.getElementById("izin-form").style.display = "none";
    document.getElementById("izin-alasan").value = "";
  }

  function loadIzinAdmin() {
    const table = document.getElementById("izin-table-admin").getElementsByTagName('tbody')[0];
    table.innerHTML = "";
    let izinData = JSON.parse(localStorage.getItem("izin") || "[]");
    izinData.forEach((d,i) => {
      const row = table.insertRow();
      row.insertCell(0).innerText = i+1;
      row.insertCell(1).innerText = d.nama;
      row.insertCell(2).innerText = d.divisi;
      row.insertCell(3).innerText = d.alasan;
      row.insertCell(4).innerText = d.tanggal;
      row.insertCell(5).innerText = d.jam;
      row.cells[3].className = "status-izin";
    });
  }
</script>

</body>
</html>
